---
  - name: "install ndb packages"
    become: yes
    yum: name={{ item }} state=present
    with_items:
      - nbd
      - qemu-img
    tags:
      - nbdserver
      
  - name: "create nbd directory"
    become: yes
    file: path={{ ORA_DATA }} state=directory owner=root group=root mode=0755
    tags:
      - nbdserver

  - name: "create asm device vote(qemu-img)"
    become: yes
    #shell: dd if=/dev/zero of={{ item.name }} bs=1M count={{ item.size }}
    shell: "qemu-img create -f raw -o size={{ item.size }}M {{ item.name }}"
    args:
      creates: "{{ item.name }}"
    with_items:
      - { name: "{{ VOTE_DEV }}", size: "{{ VOTE_BASE_SIZE + VOTE_MULTI_SIZE * groups['dbserver'] | length  }}" }
      - { name: "{{ DATA_DEV }}", size: "{{ DATA_BASE_SIZE + DATA_MULTI_SIZE * groups['dbserver'] | length }}" }
      - { name: "{{ FRA_DEV }}", size: "{{ FRA_BASE_SIZE + FRA_MULTI_SIZE * groups['dbserver'] | length }}" }
    tags:
      - nbdserver


  - name: "copy rac-nbd-server.init"
    become: yes
    template: src=rac-nbd-server.init.j2 dest=/usr/local/bin/rac-nbd-server.init owner=root group=root mode=0700
    tags:
      - nbdserver
      
  - name: "copy nbd-server.service"
    become: yes
    copy: src=rac-nbd-server.service dest=/etc/systemd/system/rac-nbd-server.service owner=root group=root mode=0700
    tags:
      - nbdserver

  - name: "daemon_reload"
    become: yes
    systemd: daemon_reload=yes
    ignore_errors: True
    tags:
      - nbdserver
      
  - name: "start_enable vxlan.service(Without NetworkManager)"
    become: yes
    service: name=rac-nbd-server.service state=started enabled=yes
    tags:
      - nbdserver